<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Syntax Validation - v11</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3B82F6;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        .version-info {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-weight: bold;
        }
        
        .test-container {
            background: white;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-header {
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-header h2 {
            margin: 0;
            font-size: 1.3em;
        }
        
        .test-content {
            padding: 30px;
            background: #fafbfc;
        }
        
        .mermaid-diagram {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 300px;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .status.checking {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
    </style>
</head>
<body>
    <h1>🔬 Mermaid Syntax Validation Test</h1>
    
    <div class="version-info">
        📌 Testing with Mermaid.js v11 (Latest Stable)
        <br>
        These are the EXACT codes generated by Railway service
    </div>
    
    <!-- Test 1: ER Diagram -->
    <div class="test-container">
        <div class="test-header">
            <h2>1. Entity Relationship Diagram (erDiagram)</h2>
            <span id="badge-er">Testing...</span>
        </div>
        <div class="test-content">
            <details>
                <summary>View Mermaid Code</summary>
                <div class="code-block">
                    <pre id="code-er"></pre>
                </div>
            </details>
            
            <div class="mermaid-diagram">
                <div class="mermaid" id="test-er">
erDiagram
    %% User entity definition
    USER {
        int id PK
        string name
        string email UK
    }
    
    %% Order entity definition
    ORDER {
        int id PK
        int user_id FK
        decimal total
    }
    
    %% Product entity definition
    PRODUCT {
        int id PK
        string name
        decimal price
    }
    
    %% Order-Product relationship (Many-to-Many)
    ORDER_PRODUCT {
        int order_id FK
        int product_id FK
        int quantity
    }
    
    %% Relationships
    USER ||--o{ ORDER : places
    ORDER ||--o{ ORDER_PRODUCT : contains
    PRODUCT ||--o{ ORDER_PRODUCT : "is in"
                </div>
            </div>
            
            <div class="status checking" id="status-er">
                Checking render status...
            </div>
        </div>
    </div>
    
    <!-- Test 2: Gantt Chart -->
    <div class="test-container">
        <div class="test-header">
            <h2>2. Gantt Chart (gantt)</h2>
            <span id="badge-gantt">Testing...</span>
        </div>
        <div class="test-content">
            <details>
                <summary>View Mermaid Code</summary>
                <div class="code-block">
                    <pre id="code-gantt"></pre>
                </div>
            </details>
            
            <div class="mermaid-diagram">
                <div class="mermaid" id="test-gantt">
gantt
    %% Simple project timeline based on user request and example structure
    %% Using an arbitrary "today" date of 2024-03-18 for calculations
    
    title Simple Project Timeline
    dateFormat YYYY-MM-DD
    axisFormat %m/%d
    excludes weekends 2024-12-25 2024-01-01 %% Example specific dates, kept for structure
    
    section Planning Phase (Week 1)
    Project Kickoff           :done, kickoff, 2024-03-18, 1d
    Requirements Gathering    :active, req, after kickoff, 4d %% Ends 2024-03-22 (Friday of Week 1)
    
    section Design Phase (Week 2-3)
    System Design             :des, sysdes, after req, 9d %% Starts 2024-03-25, ends 2024-04-04 (Thursday of Week 3)
    Design Review             :milestone, des_rev, after sysdes, 0d %% Milestone on 2024-04-05 (Friday of Week 3)
    
    section Development Phase (Week 4-6)
    Backend Development       :crit, back, after des_rev, 10d %% Starts 2024-04-08, ends 2024-04-19 (Friday of Week 5)
    Frontend Development      :crit, front, after des_rev, 12d %% Starts 2024-04-08, ends 2024-04-23 (Tuesday of Week 6)
    Database Implementation   :db, db_imp, after back, 4d %% Starts 2024-04-22, ends 2024-04-25 (Thursday of Week 6)
    Integration              :int, after front db_imp, 3d %% After both frontend and db_imp complete
    
    section Testing Phase (Week 7)
    Unit Testing             :test, unit_test, after int, 3d %% Starts after integration
    Integration Testing      :test, int_test, after unit_test, 2d
    UAT                      :uat, after int_test, 2d
    
    section Deployment (Week 8)
    Staging Deployment       :stage, after uat, 2d
    Production Release       :milestone, prod, after stage, 1d
                </div>
            </div>
            
            <div class="status checking" id="status-gantt">
                Checking render status...
            </div>
        </div>
    </div>
    
    <!-- Test 3: Kanban Board -->
    <div class="test-container">
        <div class="test-header">
            <h2>3. Kanban Board (kanban)</h2>
            <span id="badge-kanban">Testing...</span>
        </div>
        <div class="test-content">
            <details>
                <summary>View Mermaid Code</summary>
                <div class="code-block">
                    <pre id="code-kanban"></pre>
                </div>
            </details>
            
            <div class="mermaid-diagram">
                <div class="mermaid" id="test-kanban">
kanban
    %% Define the 'Backlog' column
    Backlog[Backlog]
        %% Card for Feature A
        featureA[Feature A]
        %% Card for Feature B
        featureB[Feature B]
    
    %% Define the 'In Progress' column
    InProgress[In Progress]
        %% Card for Bug Fix
        bugFix[Bug Fix]
        %% Card for Feature C
        featureC[Feature C]
    
    %% Define the 'Done' column
    Done[Done]
        %% Card for Feature D
        featureD[Feature D]
        %% Card for Feature E
        featureE[Feature E]
                </div>
            </div>
            
            <div class="status checking" id="status-kanban">
                Checking render status...
            </div>
        </div>
    </div>
    
    <!-- Test 4: Working Diagrams for Comparison -->
    <div class="test-container">
        <div class="test-header">
            <h2>4. Known Working Diagrams (Control Group)</h2>
            <span id="badge-control">Testing...</span>
        </div>
        <div class="test-content">
            <h3>Flowchart (Known to Work)</h3>
            <div class="mermaid-diagram">
                <div class="mermaid" id="test-flowchart">
flowchart TD
    Start([Start]) --> Process[Process Data]
    Process --> Decision{Valid?}
    Decision -->|Yes| Success[Success]
    Decision -->|No| Error[Error]
    Success --> End([End])
    Error --> End
                </div>
            </div>
            
            <h3>Timeline (Known to Work)</h3>
            <div class="mermaid-diagram">
                <div class="mermaid" id="test-timeline">
timeline
    title Company History
    
    2020 : Company Founded
    2021 : First Product Launch
    2022 : Series A Funding
    2023 : 100k Users
    2024 : International Expansion
                </div>
            </div>
            
            <div class="status checking" id="status-control">
                Checking render status...
            </div>
        </div>
    </div>
    
    <script>
        // Store the code for display
        const codes = {
            er: document.getElementById('test-er').textContent,
            gantt: document.getElementById('test-gantt').textContent,
            kanban: document.getElementById('test-kanban').textContent
        };
        
        // Display the code in the code blocks
        document.getElementById('code-er').textContent = codes.er;
        document.getElementById('code-gantt').textContent = codes.gantt;
        document.getElementById('code-kanban').textContent = codes.kanban;
        
        // Initialize Mermaid with permissive settings
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            logLevel: 'debug', // Enable debug logging
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            themeVariables: {
                primaryColor: '#3B82F6',
                primaryTextColor: '#fff',
                primaryBorderColor: '#2563EB',
                lineColor: '#94A3B8',
                secondaryColor: '#60A5FA',
                tertiaryColor: '#DBEAFE'
            },
            er: {
                useMaxWidth: true,
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: 'gray',
                fill: 'honeydew'
            },
            gantt: {
                useMaxWidth: true,
                numberSectionStyles: 4,
                fontSize: 11
            }
        });
        
        // Check rendering status after a delay
        setTimeout(() => {
            const tests = [
                { id: 'test-er', statusId: 'status-er', badgeId: 'badge-er', name: 'ER Diagram' },
                { id: 'test-gantt', statusId: 'status-gantt', badgeId: 'badge-gantt', name: 'Gantt Chart' },
                { id: 'test-kanban', statusId: 'status-kanban', badgeId: 'badge-kanban', name: 'Kanban Board' }
            ];
            
            let results = [];
            
            tests.forEach(test => {
                const element = document.getElementById(test.id);
                const statusElement = document.getElementById(test.statusId);
                const badgeElement = document.getElementById(test.badgeId);
                
                if (element) {
                    // Check if diagram rendered (will have SVG content)
                    const svg = element.querySelector('svg');
                    const hasError = element.textContent.includes('Syntax error') || 
                                   element.textContent.includes('Parse error');
                    
                    if (svg) {
                        statusElement.textContent = '✅ Rendering successful! Diagram is displayed correctly.';
                        statusElement.className = 'status success';
                        badgeElement.textContent = '✅ Working';
                        badgeElement.style.color = '#10b981';
                        results.push(`✅ ${test.name}: SUCCESS`);
                    } else if (hasError) {
                        const errorText = element.textContent;
                        statusElement.textContent = `❌ Syntax error: ${errorText}`;
                        statusElement.className = 'status error';
                        badgeElement.textContent = '❌ Failed';
                        badgeElement.style.color = '#ef4444';
                        results.push(`❌ ${test.name}: SYNTAX ERROR`);
                        console.error(`Error in ${test.name}:`, errorText);
                    } else if (element.textContent.trim() === codes[test.id.replace('test-', '')].trim()) {
                        statusElement.textContent = '⚠️ Diagram not rendered - Mermaid did not process this diagram';
                        statusElement.className = 'status error';
                        badgeElement.textContent = '⚠️ Not Rendered';
                        badgeElement.style.color = '#f59e0b';
                        results.push(`⚠️ ${test.name}: NOT RENDERED`);
                    } else {
                        statusElement.textContent = '❓ Unknown status';
                        statusElement.className = 'status checking';
                        badgeElement.textContent = '❓ Unknown';
                        results.push(`❓ ${test.name}: UNKNOWN`);
                    }
                }
            });
            
            // Check control group
            const controlTests = ['test-flowchart', 'test-timeline'];
            let controlWorking = true;
            controlTests.forEach(id => {
                const element = document.getElementById(id);
                if (!element || !element.querySelector('svg')) {
                    controlWorking = false;
                }
            });
            
            const controlStatus = document.getElementById('status-control');
            const controlBadge = document.getElementById('badge-control');
            
            if (controlWorking) {
                controlStatus.textContent = '✅ Control diagrams rendered successfully';
                controlStatus.className = 'status success';
                controlBadge.textContent = '✅ Working';
                controlBadge.style.color = '#10b981';
            } else {
                controlStatus.textContent = '❌ Control diagrams failed - Mermaid may not be loaded';
                controlStatus.className = 'status error';
                controlBadge.textContent = '❌ Failed';
                controlBadge.style.color = '#ef4444';
            }
            
            // Log summary to console
            console.log('=== MERMAID v11 TEST RESULTS ===');
            results.forEach(r => console.log(r));
            console.log('Control Group:', controlWorking ? '✅ Working' : '❌ Failed');
            console.log('================================');
            
        }, 2000);
        
        // Listen for Mermaid errors
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
        });
    </script>
</body>
</html>